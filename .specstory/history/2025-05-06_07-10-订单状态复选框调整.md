<!-- Generated by SpecStory -->

# 订单状态复选框调整 (2025-05-06 15:10:47)

_**User**_

订单状态调整为复选框多选，类似主界面所选区域筛选框如图1。不要修改其他的地方

---

_**Assistant**_

我明白您的需求，您想要将订单状态的筛选器改成类似图片中所示的多选复选框形式。我会修改相关代码，同时保持其他功能不变。

让我来修改 `income.html` 文件：

---

```diff
          }
  
+         /* 状态选择器样式 */
+         .status-selector {
+             position: relative;
+             display: inline-block;
+         }
+ 
+         .status-selector-header {
+             padding: 8px;
+             border: 1px solid #ddd;
+             border-radius: 4px;
+             cursor: pointer;
+             background: white;
+             min-width: 120px;
+             display: flex;
+             justify-content: space-between;
+             align-items: center;
+         }
+ 
+         .status-selector-header:after {
+             content: '▼';
+             font-size: 12px;
+             margin-left: 5px;
+         }
+ 
+         .status-selector-dropdown {
+             position: absolute;
+             top: 100%;
+             left: 0;
+             background: white;
+             border: 1px solid #ddd;
+             border-radius: 4px;
+             margin-top: 4px;
+             box-shadow: 0 2px 8px rgba(0,0,0,0.1);
+             z-index: 1000;
+             display: none;
+             padding: 8px;
+             min-width: 150px;
+         }
+ 
+         .status-selector.open .status-selector-dropdown {
+             display: block;
+         }
+ 
+         .status-option {
+             display: flex;
+             align-items: center;
+             gap: 8px;
+             padding: 6px 8px;
+             cursor: pointer;
+         }
+ 
+         .status-option:hover {
+             background: #f5f5f5;
+         }
+ 
+         .status-option input[type="checkbox"] {
+             width: 16px;
+             height: 16px;
+             cursor: pointer;
+         }
+         
          /* 表格容器支持水平滚动 */
          .table-container {
```

```diff
              <div class="filters">
                  <div class="filter-item">
-                     <label for="statusFilter">订单状态:</label>
-                     <select id="statusFilter">
-                         <option value="">全部</option>
-                         <option value="已支付">已支付</option>
-                         <option value="已退款">已退款</option>
-                         <option value="已开班">已开班</option>
-                         <option value="意向中">意向中</option>
-                         <option value="已结算">已结算</option>
-                     </select>
+                     <label>订单状态:</label>
+                     <div class="status-selector" id="statusSelector">
+                         <div class="status-selector-header">
+                             <span>全选/取消全选</span>
+                         </div>
+                         <div class="status-selector-dropdown">
+                             <label class="status-option">
+                                 <input type="checkbox" value="全选" id="selectAllStatus"> 全选/取消全选
+                             </label>
+                             <label class="status-option">
+                                 <input type="checkbox" value="已支付" class="status-checkbox"> 已支付
+                             </label>
+                             <label class="status-option">
+                                 <input type="checkbox" value="已退款" class="status-checkbox"> 已退款
+                             </label>
+                             <label class="status-option">
+                                 <input type="checkbox" value="已开班" class="status-checkbox"> 已开班
+                             </label>
+                             <label class="status-option">
+                                 <input type="checkbox" value="意向中" class="status-checkbox"> 意向中
+                             </label>
+                             <label class="status-option">
+                                 <input type="checkbox" value="已结算" class="status-checkbox"> 已结算
+                             </label>
+                         </div>
+                     </div>
                  </div>
                  <div class="filter-item">
```

```diff
          // 重置筛选器
          function resetFilters() {
-             document.getElementById('statusFilter').value = '';
+             document.getElementById('statusSelector').classList.remove('open');
+             document.getElementById('selectAllStatus').checked = false;
              document.getElementById('courseFilter').value = '';
              document.getElementById('startDate').value = '';
```

```diff
                  
                  // 获取筛选条件
-                 const statusFilter = document.getElementById('statusFilter').value;
+                 const selectedStatuses = Array.from(document.querySelectorAll('.status-checkbox:checked')).map(cb => cb.value);
                  const courseFilter = document.getElementById('courseFilter').value;
                  const startDate = document.getElementById('startDate').value ? new Date(document.getElementById('startDate').value) : null;
```

```diff
                  let filteredStudents = [...allStudents];
                  
-                 if (statusFilter) {
-                     filteredStudents = filteredStudents.filter(student => student.status === statusFilter);
+                 if (selectedStatuses.length > 0) {
+                     filteredStudents = filteredStudents.filter(student => selectedStatuses.includes(student.status));
                  }
                  
```

```diff
                  mainContent.classList.add('expanded');
              }
+ 
+             // 初始化状态选择器
+             const statusSelector = document.getElementById('statusSelector');
+             const statusHeader = statusSelector.querySelector('.status-selector-header');
+             const selectAllCheckbox = document.getElementById('selectAllStatus');
+             const statusCheckboxes = document.querySelectorAll('.status-checkbox');
+ 
+             // 点击头部显示/隐藏下拉框
+             statusHeader.addEventListener('click', (e) => {
+                 e.stopPropagation();
+                 statusSelector.classList.toggle('open');
+             });
+ 
+             // 点击其他地方关闭下拉框
+             document.addEventListener('click', () => {
+                 statusSelector.classList.remove('open');
+             });
+ 
+             // 阻止下拉框点击事件冒泡
+             statusSelector.querySelector('.status-selector-dropdown').addEventListener('click', (e) => {
+                 e.stopPropagation();
+             });
+ 
+             // 全选/取消全选功能
+             selectAllCheckbox.addEventListener('change', () => {
+                 statusCheckboxes.forEach(cb => {
+                     cb.checked = selectAllCheckbox.checked;
+                 });
+                 renderIncomeData();
+             });
+ 
+             // 单个状态选择变化时更新全选状态
+             statusCheckboxes.forEach(cb => {
+                 cb.addEventListener('change', () => {
+                     const allChecked = Array.from(statusCheckboxes).every(cb => cb.checked);
+                     selectAllCheckbox.checked = allChecked;
+                     renderIncomeData();
+                 });
+             });
  
              // 加载收益数据
```

```diff
  
                  // 获取当前筛选条件
-                 const statusFilter = document.getElementById('statusFilter').value;
+                 const selectedStatuses = Array.from(document.querySelectorAll('.status-checkbox:checked')).map(cb => cb.value);
                  const courseFilter = document.getElementById('courseFilter').value;
                  const startDate = document.getElementById('startDate').value;
```

```diff
  
                  const filters = {
-                     status: statusFilter,
+                     status: selectedStatuses.join(','),
                      course: courseFilter,
                      startDate,
```

```diff
                  
                  // 应用当前筛选条件获取数据
-                 const statusFilter = document.getElementById('statusFilter').value;
+                 const selectedStatuses = Array.from(document.querySelectorAll('.status-checkbox:checked')).map(cb => cb.value);
                  const courseFilter = document.getElementById('courseFilter').value;
                  const startDate = document.getElementById('startDate').value ? new Date(document.getElementById('startDate').value) : null;
```

```diff
                  let exportData = [...allStudents];
                  
-                 if (statusFilter) {
-                     exportData = exportData.filter(student => student.status === statusFilter);
+                 if (selectedStatuses.length > 0) {
+                     exportData = exportData.filter(student => selectedStatuses.includes(student.status));
                  }
                  
```

---

我已经完成了订单状态筛选器的改造，主要做了以下修改：

1. 添加了新的状态选择器样式，包括下拉框、选项样式等
2. 将原来的 `select` 元素替换为自定义的多选下拉框结构
3. 添加了全选/取消全选功能
4. 修改了相关的 JavaScript 代码，包括：
   - 初始化状态选择器
   - 处理点击事件和下拉框显示/隐藏
   - 更新筛选逻辑以支持多选
   - 修改重置筛选器功能
   - 更新导出 Excel 和 AI 分析相关的筛选条件获取方式

现在，订单状态筛选器的功能和外观与图片中所示的区域选择框类似，支持多选功能，并且保持了原有的所有其他功能不变。用户可以：

1. 点击下拉框显示所有状态选项
2. 选择多个状态进行筛选
3. 使用全选/取消全选快速操作
4. 点击其他区域自动关闭下拉框
5. 选择状态后自动更新表格数据

这些修改不会影响其他功能的正常使用，包括导出 Excel、AI 分析等功能都已经适配了新的多选筛选方式。

---

